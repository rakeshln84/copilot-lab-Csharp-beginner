# Refactoring the code

In this step, we will refactor the code to fix some issues and improve the code quality. We will use GitHub Copilot to help us with the refactoring process.

1. The Search methods that we implemented in the previous exercise are case-sensitive. Let's refactor these methods to ignore case when comparing strings.
   Using GitHub Copilot, refactor the `SearchAlbumsByArtist`, `SearchAlbumsByTitle` and `SearchAlbumsByGenre` methods to ignore case when comparing strings.

   The modified methods should look like this after refactoring:

   ```csharp

       public List<Album> SearchAlbumsByArtist(string artist)
       {
           return _albums.Where(a => a.Artist.Equals(artist, StringComparison.OrdinalIgnoreCase)).ToList();
       }

       public List<Album> SearchAlbumsByTitle(string title)
       {
           return _albums.Where(a => a.Title.Equals(title, StringComparison.OrdinalIgnoreCase)).ToList();
       }

       public List<Album> SearchAlbumsByGenre(string genre)
       {
           var genreId = _albums.FirstOrDefault(a => a.Genre.Name.Equals(genre, StringComparison.OrdinalIgnoreCase))?.Genre.Id;
           if (genreId != null)
               return _albums.Where(a => a.Genre.Id == genreId).ToList();
           return new List<Album>();
       }

   ```

2. Refactor the `AddAlbum` method to check if the album already exists before adding it to the list. If the album already exists, throw an exception with the message "Album already exists".

   The modified `AddAlbum` method should look like this after refactoring:

   ```csharp

        public void AddAlbum(Album album)
        {
             if (_albums.Any(a => a.Id == album.Id))
             {
               throw new Exception("Album already exists");
             }

             _albums.Add(album);
        }

   ```

3. Add a custom exception class `AlbumAlreadyExistsException`. Refactor the `AddAlbum` method to throw the custom exception when the album already exists.

   The custom exception class should look like this:

   ```csharp

       public class AlbumAlreadyExistsException : Exception
       {
           public AlbumAlreadyExistsException(string message) : base(message)
           {
           }
       }

   ```

use copilot to add a new method to print the albums

```csharp

         public static void PrintAlbums(List<Album> albums)
        {
            Console.WriteLine("--------------------------------------------------------------");
            Console.WriteLine("|   ID   |        Title        |       Artist       |   Genre   |");
            Console.WriteLine("--------------------------------------------------------------");
            foreach (var album in albums)
            {
                Console.WriteLine($"| {album.Id,-6} | {album.Title,-19} | {album.Artist,-18} | {album.Genre,-9} |");
            }
            Console.WriteLine("--------------------------------------------------------------");
        }

```

update program file to ask the user with the following options: search albums by artist, title, genre

```csharp

       public static void Main(string[] args)
    {
        // Instantiate the repository
        var musicStoreService = new MusicStoreService();

        // Get all albums
        var albums = musicStoreService.GetAlbums();
        // Print all albums
        PrintAlbums(albums);

        Console.WriteLine();
        Console.WriteLine("****************************************************************");

        Console.WriteLine("Search albums by:");
        Console.WriteLine("1. Artist");
        Console.WriteLine("2. Title");
        Console.WriteLine("3. Genre");

        Console.WriteLine("****************************************************************");

        var option = Console.ReadLine();

        switch (option)
        {
            case "1":
                Console.WriteLine("Enter artist name:");
                var artist = Console.ReadLine();
                var albumsByArtist = musicStoreService.SearchAlbumsByArtist(artist);
                PrintAlbums(albumsByArtist);
                break;
            case "2":
                Console.WriteLine("Enter title:");
                var title = Console.ReadLine();
                var albumsByTitle = musicStoreService.SearchAlbumsByTitle(title);
                PrintAlbums(albumsByTitle);
                break;
            case "3":
                Console.WriteLine("Enter genre:");
                var genre = Console.ReadLine();
                var albumsByGenre = musicStoreService.SearchAlbumsByGenre(genre);
                PrintAlbums(albumsByGenre);
                break;
            default:
                Console.WriteLine("Invalid option");
                break;
        }
    }

```

use explain method to understand the code.

Other challenges you can try:

- Validate the album properties before adding the album
- Partial Search

Remove irrelevant requests
Organize your conversations with threads

[Refactoring the code](./03-Step03.md) | [Add Unit Tests](./04-Step04.md)
