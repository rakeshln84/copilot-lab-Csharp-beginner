# Refactoring the code

In this step, we will refactor the code to fix some issues and improve the code quality. We will use GitHub Copilot to help us with the refactoring process.

1.  The Search methods that we implemented in the previous exercise are case-sensitive. Let's refactor these methods to ignore case when comparing strings.

    Using GitHub Copilot, refactor the `SearchAlbumsByArtist`, `SearchAlbumsByTitle` and `SearchAlbumsByGenre` methods to ignore case when comparing strings.

2.  Refactor the `AddAlbum` method to check if the album already exists before adding it to the list. If the album already exists, throw an exception with the message "Album already exists".

    The modified `AddAlbum` method should look like this after refactoring:

    ```csharp

         public void AddAlbum(Album album)
         {
              if (_albums.Any(a => a.Id == album.Id))
              {
                throw new Exception("Album already exists");
              }

              _albums.Add(album);
         }

    ```

3.  Add a custom exception class `AlbumAlreadyExistsException`. Refactor the `AddAlbum` method to throw the custom exception when the album already exists.

4.  Let us now update the application to provide the user with options to search albums by artist, title, or genre. Based on the user's choice, the application should display the list of albums that match the search criteria.

    Update the `Main` method in the `Program.cs` file to provide the user with the following options:

    - Search albums by artist
    - Search albums by title
    - Search albums by genre

    Use the `PrintAlbums` method below to print the list of albums to the console.

    ```csharp

        public static void PrintAlbums(List<Album> albums)
       {
           Console.WriteLine("--------------------------------------------------------------");
           Console.WriteLine("|   ID   |        Title        |       Artist       |   Genre   |");
           Console.WriteLine("--------------------------------------------------------------");
           foreach (var album in albums)
           {
               Console.WriteLine($"| {album.Id,-6} | {album.Title,-19} | {album.Artist,-18} | {album.Genre,-9} |");
           }
           Console.WriteLine("--------------------------------------------------------------");
       }
    ```

    The updated `Main` method should look like this:
    After updating the `Main` method, try using the slash command `/explain` to ask Copilot to explain the code to you.

    ```csharp

    public static void Main(string[] args)
    {
            var musicStoreService = new MusicStoreService();
            var albums = musicStoreService.GetAlbums();

            Console.WriteLine("Choose an option:");
            Console.WriteLine("1. Search albums by artist");
            Console.WriteLine("2. Search albums by title");
            Console.WriteLine("3. Search albums by genre");

            var option = Console.ReadLine();

            switch (option)
            {
            case "1":
                Console.WriteLine("Enter artist name:");
                var artist = Console.ReadLine();
                var albumsByArtist = musicStoreService.SearchAlbumsByArtist(artist);
                PrintAlbums(albumsByArtist);
                break;
            case "2":
                Console.WriteLine("Enter title:");
                var title = Console.ReadLine();
                var albumsByTitle = musicStoreService.SearchAlbumsByTitle(title);
                PrintAlbums(albumsByTitle);
                break;
            case "3":
                Console.WriteLine("Enter genre:");
                var genre = Console.ReadLine();
                var albumsByGenre = musicStoreService.SearchAlbumsByGenre(genre);
                PrintAlbums(albumsByGenre);
                break;
            default:
                Console.WriteLine("Invalid option");
                break;
            }
    }

    ```

## Try the other challenges below:

- Validate the album properties before adding the album
- Update the search methods to allow partial matches
- Sort the albums by release date before displaying them

[Refactoring the code](./03-Step03.md) | [Add Unit Tests](./04-Step04.md)
